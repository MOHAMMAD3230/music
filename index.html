<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Music App</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
  input, button { font-size: 1rem; padding: 0.5rem; margin: 0.5rem 0; width: 100%; }
  ul { list-style: none; padding: 0; }
  li { border-bottom: 1px solid #ddd; padding: 0.5rem 0; }
</style>
</head>
<body>
<h1>Login</h1>
<form id="loginForm">
  <input id="username" placeholder="Username" required />
  <input id="password" type="password" placeholder="Password" required />
  <button type="submit">Login</button>
</form>
<p id="status" aria-live="polite"></p>

<h2>Your Playlist</h2>
<ul id="playlist"></ul>
<button id="clearBtn" style="display:none;">Clear Playlist</button>

<script>
  const API_BASE_URL = 'https://your-heroku-app-name.herokuapp.com'; // Replace with your deployed backend URL

  const loginForm = document.getElementById('loginForm');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const status = document.getElementById('status');
  const playlistEl = document.getElementById('playlist');
  const clearBtn = document.getElementById('clearBtn');

  let token = null;

  loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    status.textContent = 'Logging in...';

    try {
      const res = await fetch(`${API_BASE_URL}/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: usernameInput.value,
          password: passwordInput.value
        })
      });

      if (!res.ok) throw new Error('Invalid username or password');

      const data = await res.json();
      token = data.token;
      status.textContent = 'Login successful';
      clearBtn.style.display = 'block';
      await loadPlaylist();
    } catch (err) {
      status.textContent = err.message;
    }
  });

  async function loadPlaylist() {
    if (!token) return;
    try {
      const res = await fetch(`${API_BASE_URL}/api/playlists`, {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      if (!res.ok) throw new Error('Failed to load playlist');
      const songs = await res.json();
      displayPlaylist(songs);
    } catch (err) {
      status.textContent = err.message;
    }
  }

  function displayPlaylist(songs) {
    playlistEl.innerHTML = '';
    if (songs.length === 0) {
      playlistEl.innerHTML = '<li>No songs in your playlist.</li>';
      return;
    }
    songs.forEach(song => {
      const li = document.createElement('li');
      li.textContent = song.trackName || song.name || 'Untitled Song';
      playlistEl.appendChild(li);
    });
  }

  clearBtn.addEventListener('click', async () => {
    if (!token) return alert('Please login first');
    if (!confirm('Clear the entire playlist?')) return;
    try {
      const res = await fetch(`${API_BASE_URL}/api/playlists`, {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer ' + token }
      });
      if (!res.ok) throw new Error('Failed to clear playlist');
      await loadPlaylist();
    } catch (err) {
      status.textContent = err.message;
    }
  });

</script>
</body>
</html>
